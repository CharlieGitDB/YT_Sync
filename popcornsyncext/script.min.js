var joined,sessionId,sessionObj,video=document.getElementsByTagName("video")[0];$(function(){function a(){$(".ytp-play-button").hide(),$(".ytp-left-controls").prepend('<button class="popcornPlayBtn ytp-button" aria-label="Play"><svg xmlns:xlink="http://www.w3.org/1999/xlink" height="100%" version="1.1" viewBox="0 0 36 36" width="100%"><defs><path d="M11,10 L18,13.74 18,22.28 11,26 Z M18,13.74 L26,18 26,18 18,22.28 Z" id="ytp-svg-31"></path></defs><use class="ytp-svg-shadow" xlink:href="#ytp-svg-31"></use><use class="ytp-svg-fill" xlink:href="#ytp-svg-31"></use></svg></button><button class="popcornPauseBtn ytp-button" aria-label="Pause"><svg xmlns:xlink="http://www.w3.org/1999/xlink" height="100%" version="1.1" viewBox="0 0 36 36" width="100%"><use class="ytp-svg-shadow" xlink:href="#ytp-svg-transition-12"></use><path class="ytp-svg-fill" d="M 11,26 15.33,26 15.33,10 11,10 z M 19.66,26 24,26 24,10 19.66,10 z" id="ytp-svg-transition-12"></path></svg></button>'),video.playing?console.log(!0):console.log(!1),$("body").on("click",".popcornPlayBtn",function(){sessionObj.videoTime=video.currentTime,b.emit("play yt",sessionObj)}),$("body").on("click",".popcornPauseBtn",function(){sessionObj.videoTime=video.currentTime,b.emit("pause yt",sessionObj)})}console.log("POPCORN SYNC LOADED");var b=io.connect("https://localhost:3000"),c='<div class="youtubeContainerPop"><div class="closeBtn">X</div><div class="buttonContainerPop"><button class="menuBtn menuBtnActive csPop">Create Sync</button><button class="menuBtn jsPop">Join Sync</button></div><div class="contentContainerPop"><div class="createSyncContentPop"><p>To create a sync session click the button below and wait for instructions.</p><button class="menuBtn startSync">Start</button></div><div class="joinSyncContentPop"><p>Input the session id you were given below:</p><input type="text" class="joinIdText"/><br><button class="menuBtn joinSessionBtn">Join</button></div></div></div>';$(document).on("keydown",function(a){80===a.which&&a.ctrlKey&&(a.preventDefault(),console.log("You pressed CTRL+P"),window.location.href.indexOf("youtube")>=0&&(video.play&&video.pause(),0==$(".youtubeContainerPop").length?($("body").append(c),$(".joinSyncContentPop").hide()):$(".youtubeContainerPop").is(":visible")?$(".youtubeContainerPop").hide():$(".youtubeContainerPop").show()))}),$("body").on("click",".closeBtn",function(){$(".youtubeContainerPop").hide()}),$("body").on("click",".csPop",function(){$(this).hasClass("menuBtnActive")||($(this).addClass("menuBtnActive"),$(".jsPop").removeClass("menuBtnActive"),$(".joinSyncContentPop").hide(),$(".createSyncContentPop").show())}),$("body").on("click",".jsPop",function(){$(this).hasClass("menuBtnActive")||($(this).addClass("menuBtnActive"),$(".csPop").removeClass("menuBtnActive"),$(".joinSyncContentPop").show(),$(".createSyncContentPop").hide(),$(".joinIdText").focus())}),$("body").on("click",".startSync",function(){$("#player-api").css("pointer-events","none"),sessionObj={videoTime:video.currentTime,sessionId:sessionId},joined=!1,b.emit("start sync",sessionObj)}),b.on("session id",function(a){sessionObj=a,$(".createSyncContentPop").html('<p>Send your friend the session id below:</p><input type="text" value="'+sessionObj.sessionId+'" class="sessionIdTxt"/><br><button class="menuBtn copyToClip">Copy Session Id</button>')}),$("body").on("click",".sessionIdTxt",function(){$(this).select()}),$("body").on("click",".copyToClip",function(){$(".sessionIdTxt").select(),document.execCommand("copy"),$(this).text("Copied"),$(this).css("opacity","0.5")}),$("body").on("click",".joinSessionBtn",function(){video.pause(),joined=!0;var a=$(".joinIdText").val();b.emit("join sync",a),$("#player-api").css("pointer-events","none")}),b.on("init information",function(a){sessionObj=a,video.currentTime=sessionObj.videoTime,b.emit("synced",sessionObj.sessionId)}),b.on("synced",function(){console.log("synced"),0==joined&&$("#player-api").css("pointer-events","all"),$(".buttonContainerPop, .contentContainerPop").hide(),$(".youtubeContainerPop").append('<div class="connected"></div>'),$(".connected").text("You are now synced!"),a()}),b.on("sync error",function(){console.log("Sync ERROR")}),b.on("play yt",function(a){$(".popcornPlayBtn").hide(),$(".popcornPauseBtn").show(),video.currentTime=a.videoTime,video.play()}),b.on("pause yt",function(a){$(".popcornPauseBtn").hide(),$(".popcornPlayBtn").show(),video.currentTime=a.videoTime,video.pause()})});